<html>
	<head>
		<!-- <link rel="stylesheet" type="text/css" href="css/style.css"> -->
		<!-- Set min-width in node-webkit to 310px -->
		<style type='text/css'>
			html, body {
				margin:0;
				padding:0;
				height:100%;
				width:100%;
				font-size: 10.5pt;
				font-family: helvetica;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			#lcol {
				overflow: hidden;
				overflow-y:scroll;
			}

			.iconImg {
				height:16px;
				width:16px;
				position:absolute;
				bottom:0;
			}

			.iconImgObject {
				height:16px;
				width:16px;
				margin-left:16px;
				position:absolute;
				bottom:2.5px;
			}

			.searchbarCont {
				z-index: 3;
				background-color:rgb(230, 233, 240);
				border-bottom:1px #232323 solid;
			}

			#search:focus {
				outline-width: 0;
			}

			#search {
				position:relative;
				height:30px;
				background-color: rgb(230, 233, 240);
				border:1px solid #232323;
				width:-moz-calc(100% - 26px);
				width:-webkit-calc(100% - 26px);
				width:-o-calc(100% - 26px);
				width:calc(100% - 26px);
				padding-left:4px;
				margin:0;
				color: #232323;
				background-color: #fdfdfd;
				margin-left:13px;
				margin-top:13px;
				margin-bottom: 13px;
				font-size: 9pt;
			}

			.loadbar {
				height:140%;
				left:30px;
				top:-12px;
				/*ie 9+, opera, etc work fine */
				-webkit-transform:rotate(30deg);
				-moz-transform:rotate(30deg);
				-o-transform:rotate(30deg);
				-ms-transform:rotate(30deg);
				transform:rotate(30deg);
				width:20px;
				background-color: #232323; /*#DEDEDE;*/
				position:absolute;
				-moz-animation: load 1s infinite linear;
				-webkit-animation: load 1s infinite linear;
				animation: load 1s infinite linear;
			}

			@-webkit-keyframes load {
				from {
					margin-left:1;
				}

				to {
					margin-left:60;
				}
			}

			@-moz-keyframes load {
				from {
					margin-left:1;
				}

				to {
					margin-left:60;
				}
			}

			@keyframes load {
				from {
					margin-left:1;
				}

				to {
					margin-left:60;
				}
			}

			.itemBar {
				height:20px;
				line-height:20px;
				/*overflow: hidden;*/
				position:relative;
				font-size: 9pt;
				z-index: 2;
				width:-moz-calc(100% + 6px);
				width:-webkit-calc(100% + 6px);
				width:-o-calc(100% + 6px);
				width:calc(100% + 6px);
			}

			.itemInner {
				cursor:pointer;
			}

			.itemText {
				margin-left: 18px;
			}

			.itemTextObject {
				margin-left: 34px;
			}

			.i0 {
				margin-left: 12px; /*12 + 18 * level px */
			}

			.i1 {
				margin-left: 30px;
			}

			.i2 {
				margin-left: 48px;
			}

			.i3 {
				margin-left: 64px;
			}

			.folder {

			}

		</style>
	</head>
	<body>
		<div id = 'lcol' style = 'position:relative;background-color:rgb(230, 233, 240);float:left;margin:0;padding:0;width:250px;height:100%;'>
			<div class = 'searchbarCont' style ='position:fixed;'>
				<div style = 'overflow:hidden;'>
					<div class = 'loadbar' style='left:-60px;'></div>
					<div class = 'loadbar' style='left:0px;'></div>
					<div class = 'loadbar' style='left:60px;'></div>
					<div class = 'loadbar' style='left:120px;'></div>
					<div class = 'loadbar' style='left:180px;'></div>
					<div class = 'loadbar' style='left:240px;'></div>
					<div class = 'loadbar' style='left:300px;'></div>
					<div class = 'loadbar' style='left:360px;'></div>
					<div class = 'loadbar' style='left:420px;'></div>
					<div class = 'loadbar' style='left:480px;'></div>
					<div class = 'loadbar' style='left:540px;'></div>
					<div class = 'loadbar' style='left:600px;'></div>
				</div>
				<input type='text' id = 'search' placeholder='Search docs'/>
			</div>
			<div style = 'position:relative;height:57px;'></div>
			<div id = 'tree'></div>
		</div>
		<div id = 'separator' style = 'position:relative;background-color:rgb(230, 233, 240);float:left;padding:0;margin:0;width:6px;height:100%;cursor:ew-resize;'>
			<div style = 'position:relative;height:56px;border-bottom: 1px solid #000; margin:0; padding: 0;width:100%;'></div>
		</div>
		<div id = 'rcol' style = 'position:relative;float:left;margin:0;width:400px;height:100%;'>
			<iframe id = 'display' src="splash.html" style = 'width:100%; height:100%;border:none;padding:0;margin:0;'></iframe>
			<div id = 'displayCover' style = 'position:absolute;width:100%;height:100%;top:0;left:0;background-color:rgba(0, 0, 0, 0);z-index:-1;'></div>
		</div>

		<script type='text/javascript' src='js/jquery.js'></script>
		<script type="text/javascript">
			$('#separator').bind('mousedown', function(e) {
				document.body.style.cursor = 'ew-resize';
				$('#displayCover').css('z-index', '2');
				$(window).bind('mousemove', separatorMove);
			});

			$(window).bind('mouseup', separatorMouseUp);
			$(window).resize(windowResize);
			$('#rcol').css('width', parseInt($(document).width(), 10) - parseInt($('#lcol').width(), 10) - 6 + 'px'); //set right col relative to left
			$('.searchbarCont').css('width', $('#lcol').width() + 'px');

			stopSearchbarLoadingAnim();
			var selected;

			$.get('/plugins/python/output/pyDocs.json', function(d){
				importJSON(JSON.parse(d));
			});

			function importJSON(json) {
				//import docs from json
				var path = '/plugins/' + json.info.source;
				var pages = json.info.pages;
				var items = [];
				var docsHeader = $('<div>', {class:'itemBar folder'});
				var folderImg = $('<img>', {src:"img/folder-open.png"});
				var iconImg = $('<img>', {src:'/plugins/' + json.info.icons.path + json.info.icons.mainIcon, class:'iconImg'});
				var folderTitle = $('<span>', {class: 'itemInner i0'})
				var folderText = $('<span>', {class: 'itemText', text:json.info.name})
				docsHeader.append(folderTitle);
				docsHeader[0].folderImg = folderImg;
				folderTitle.prepend(iconImg);
				folderTitle.prepend(folderImg);
				folderTitle.append(folderText);
				var setDIV = $('<div>');
				for (var i in json.docs) {
					var src = json.info.icons.docsIcons[i].search('/') == -1 ? 'img/objects/' + json.info.icons.docsIcons[i] : '/plugins/' + json.info.icons.path + json.info.icons[i];
					if (i !== json.info.pages) {
						var objectsToAppend = [];
						for (var j in json.docs[i]) {
							objectsToAppend.push(makeItem(json.docs[i][j][0], path + json.docs[i][j][1], src));
						}
						addFolder(i, 1, setDIV, src, objectsToAppend);
					}
				}
				$('#tree').append(docsHeader);
				$('#tree').append(setDIV);
				docsHeader[0].setDIV = setDIV;
				docsHeader.bind('click', function(){
					this.folderImg.attr('src', this.folderImg.attr('src') == 'img/folder-closed.png' ? 'img/folder-open.png' : 'img/folder-closed.png');
					this.setDIV.toggle();
				});
				$('.selectable').bind('click', itemClicked);
				setDIV.children('.folder').each(function(key, value) {
					value.setDIV.toggle();
				});
			}

			function makeItem(text, itemURL, imgPath) {
				var cont = $('<div>', {class:'itemBar selectable'});
				cont[0].itemURL = itemURL;
				cont.bind('click', function () {
					setFrameURL(this.itemURL);
				});

				var innerCont = $('<span>', {class: 'itemInner i2'});
				cont.append(innerCont);

				var iconImg = $('<img>', {class:'iconImgObject', src:imgPath})
				innerCont.prepend(iconImg);

				var desc = $('<span>', {class:'itemTextObject', text:text});
				innerCont.append(desc);

				return cont;

			}

			function addFolder(name, indentationLevel, elem, imgPath, inner) {
				var setDIV = $('<div>');
				var folder = $('<div>', {class:"itemBar folder"});
				var folderImg = $('<img>', {src:"img/folder-closed.png"});
				var folderText = $('<span>', {class: 'itemText', text:name})
				folderImg.css('margin-top', '1px');
				var folderTitle = $('<span>', {class: 'itemInner i1'})
				folderTitle.append(folderText);
				if (inner) {
					for (var i = 0; i < inner.length; i++) {
						setDIV.append(inner[i]);
					}
				}

				var iconImg = $('<img>', {src:imgPath, class:'iconImg'});
		
				folderTitle.prepend(iconImg);

				folder[0].setDIV = setDIV;
				folder[0].folderImg = folderImg;
				folder.append(folderTitle);
				folderTitle.prepend(folderImg)
				elem.append(folder);
				elem.append(setDIV);
				folderTitle.prepend(folderImg);

				folder.bind('click', function(){
					this.folderImg.attr('src', this.folderImg.attr('src') == 'img/folder-closed.png' ? 'img/folder-open.png' : 'img/folder-closed.png');
					this.setDIV.toggle();
				});

				return folder;
			}

			function itemClicked() {
				if (selected) {
					$(selected).css('background-color', 'rgb(230, 233, 240)');
					$(selected).css('color', '#232323');
				}
				selected = this;
				$(this).css('background-color', '#232323');
				$(this).css('color', 'rgb(230, 233, 240)');
			}

			function windowResize() {
				$('#rcol').css('width', parseInt($(window).width(), 10) - parseInt($('#lcol').width(), 10) - 6 + 'px');
			}

			function separatorMove(e) {
				if (e.clientX < 150) { //set minimum width of left column to 150px
					$('#lcol').css('width', '140px'); //go to the lowest possible value if it is trying to be dragged smaller
					$('.searchbarCont').css('width, 140px');
					$('#rcol').css('width', parseInt($(window).width(), 10) - parseInt($('#lcol').width(), 10) - 6 + 'px');
					return;
				}

				if (e.clientX > 625) { //set minimum width of right column to 150px
					$('#rcol').css('width', parseInt($(window).width(), 10) - parseInt($('#lcol').width(), 10) - 6 + 'px');
					return;
				}

				if (parseInt($(window).width(), 10) - e.clientX < 150) { //set minimum width of right column to 150px
					$('#lcol').css('width', parseInt($(window).width(), 10) - 144 + 'px'); //go to the lowest possible value if it is trying to be dragged smallerq
					$('.searchbarCont').css('width', $('#lcol').width() + 'px');
					$('#rcol').css('width', parseInt($(window).width(), 10) - parseInt($('#lcol').width(), 10) - 6 + 'px');
					return;
				}

				$('#lcol').css('width', e.clientX - 3 + 'px');
				$('.searchbarCont').css('width', $('#lcol').width() + 'px');
				$('#rcol').css('width', parseInt($(window).width(), 10) - e.clientX - 3 + 'px');
			}

			function separatorMouseUp(e) {
				document.body.style.cursor = '';
				$('#displayCover').css('z-index', '-1');
				$(window).unbind('mousemove', separatorMove);
			}

			function startSearchbarLoadingAnim() {
				var bars = document.getElementsByClassName('loadbar');
				for (var i = 0; i < bars.length; i++) {
					bars[i].style.visibility = "";
					bars[i].style.webkitAnimationPlayState = "running";
				}
			};

			function stopSearchbarLoadingAnim() {
				var bars = document.getElementsByClassName('loadbar');
				for (var i = 0; i < bars.length; i++) {
					bars[i].style.webkitAnimationPlayState = "paused";
					bars[i].style.visibility = "hidden";
				}
			};

			function setFrameURL(url) {
				if (!url) {
					setFrameURL('splash.html');
				}
				else {
					document.getElementById('display').src = url;
				}
			}
		</script>
	</body>
</html>